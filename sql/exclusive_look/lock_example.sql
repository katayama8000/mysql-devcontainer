-- MySQLのロック機能を試すためのサンプルスクリプトです。
-- 実行するには、MySQLへの接続を2つ（セッション1とセッション2）開いてください。

USE mydatabase;

-- ステップ1: セッション1でトランザクションを開始し、行をロックします。
-- セッション1で実行してください。
START TRANSACTION;

-- usersテーブルのidが1のユーザーを選択し、排他ロック（FOR UPDATE）をかけます。
-- これにより、他のトランザクションはこの行を更新できなくなります。
SELECT * FROM users WHERE id = 1 FOR UPDATE;

-- ここでセッション1はロックを保持したまま待機します。

-- ステップ2: セッション2で、ロックされた行を更新しようと試みます。
-- セッション2で実行してください。
-- このコマンドは、セッション1がコミットまたはロールバックするまで「待機中」になります。
-- プロンプトが戻ってこないことを確認してください。
UPDATE users SET name = '新しい名前' WHERE id = 1;

-- セッション2は、セッション1がロックを解除するまで待ち続けます。

-- ステップ3: セッション1でトランザクションを完了し、ロックを解除します。
-- セッション1に戻り、以下のコマンドを実行してください。
COMMIT;

-- COMMIT後、セッション2の待機が解除され、更新が完了します。

-- ステップ4: 更新結果の確認
-- 最後に、テーブルの内容を確認して、変更が反映されたことを確認します。
SELECT * FROM users WHERE id = 1;
