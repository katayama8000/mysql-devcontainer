# 共通テーブル式（CTE: Common Table Expression）

## 概要

共通テーブル式（CTE）は、WITH句を使用して一時的な名前付き結果セットを定義する機能です。CTEを使用することで、複雑なクエリを読みやすく、保守しやすくすることができます。

## CTEの利点

1. **可読性の向上**: 複雑なサブクエリを名前付きで分割できる
2. **再利用性**: 同じクエリ内で複数回参照できる
3. **再帰クエリ**: 階層構造やツリー構造のデータを扱える
4. **メンテナンス性**: ロジックの分離により保守が容易

## 基本構文

```sql
WITH cte_name AS (
  SELECT ...
)
SELECT * FROM cte_name;
```

## サンプルファイルの内容

### 1. シンプルなCTE
年齢フィルタリングの例を使って、CTEの基本的な使い方を示します。

### 2. 複数のCTE
複数のCTEを組み合わせて、より複雑な分析を行う方法を示します。

### 3. 再帰CTE（基本）
数列を生成する簡単な再帰CTEの例です。

### 4. 再帰CTE（階層構造）
組織図のような階層構造をたどる実践的な例です。

### 5. ウィンドウ関数との組み合わせ
ROW_NUMBER()などのウィンドウ関数とCTEを組み合わせた例です。

## 実行方法

```bash
# MySQLに接続
mysql -u root -p your_database

# SQLファイルを実行
source /workspace/sql/cte/basic_cte_example.sql
```

## 注意点

- 再帰CTEでは、無限ループを防ぐために適切な終了条件を設定する
- CTEはクエリ実行時のみ有効で、永続化されない
- パフォーマンスが重要な場合は、実行計画を確認する
